{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/_data.ts"],"sourcesContent":["import type { User, WasteLog, PickupRequest, ActivityLog, Transport, Notification } from \"./_types\"\r\n\r\n// Dummy users (in-memory). Use x-user-id header to pick one.\r\nexport const users: User[] = [\r\n  {\r\n    id: \"u-admin-1\",\r\n    name: \"Alice Admin\",\r\n    email: \"alice@greencafe.com\",\r\n    passwordHash: \"password\", // TODO: hash passwords\r\n    role: \"admin\",\r\n    organizationName: \"Green Café\",\r\n    cafeId: \"cafe-1\",\r\n  },\r\n  {\r\n    id: \"u-staff-1\",\r\n    name: \"Sam Staff\",\r\n    email: \"sam@greencafe.com\",\r\n    passwordHash: \"password\",\r\n    role: \"staff\",\r\n    organizationName: \"Green Café\",\r\n    cafeId: \"cafe-1\",\r\n  },\r\n  {\r\n    id: \"u-charity-1\",\r\n    name: \"Charlie Charity\",\r\n    email: \"charity@help.org\",\r\n    passwordHash: \"password\",\r\n    role: \"charity\",\r\n    organizationName: \"Hope Charity\",\r\n    cafeId: null,\r\n  },\r\n  {\r\n    id: \"u-farmer-1\",\r\n    name: \"Fiona Farmer\",\r\n    email: \"farm@soil.com\",\r\n    passwordHash: \"password\",\r\n    role: \"farmer\",\r\n    organizationName: \"Soil & Co\",\r\n    cafeId: null,\r\n  },\r\n]\r\n\r\nexport const wasteLogs: WasteLog[] = [\r\n  {\r\n    id: \"w1\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"edible\",\r\n    itemName: \"Pastries\",\r\n    quantity: 15,\r\n    expiryDate: \"2025-12-05\",\r\n    status: \"pending\",\r\n    assignedTo: \"charity\",\r\n    createdAt: \"2025-12-01T08:00:00Z\",\r\n    updatedAt: \"2025-12-01T08:00:00Z\",\r\n  },\r\n  {\r\n    id: \"w2\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"organic\",\r\n    itemName: \"Vegetable Scraps\",\r\n    quantity: 22,\r\n    expiryDate: \"2025-12-04\",\r\n    status: \"pending\",\r\n    assignedTo: \"farmer\",\r\n    createdAt: \"2025-12-01T09:00:00Z\",\r\n    updatedAt: \"2025-12-01T09:00:00Z\",\r\n  },\r\n  {\r\n    id: \"w3\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"coffee\",\r\n    itemName: \"Coffee Grounds\",\r\n    quantity: 10,\r\n    expiryDate: \"2025-12-03\",\r\n    status: \"collected\",\r\n    assignedTo: \"farmer\",\r\n    createdAt: \"2025-11-30T10:00:00Z\",\r\n    updatedAt: \"2025-12-01T10:00:00Z\",\r\n  },\r\n  {\r\n    id: \"w4\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"edible\",\r\n    itemName: \"Sandwiches\",\r\n    quantity: 8,\r\n    expiryDate: \"2025-12-02\",\r\n    status: \"dropped\",\r\n    assignedTo: \"charity\",\r\n    createdAt: \"2025-11-30T11:00:00Z\",\r\n    updatedAt: \"2025-12-01T11:00:00Z\",\r\n  },\r\n  // Add more available items for charity\r\n  {\r\n    id: \"w5\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"edible\",\r\n    itemName: \"Fresh Bread\",\r\n    quantity: 12,\r\n    expiryDate: \"2025-12-10\",\r\n    status: \"pending\",\r\n    assignedTo: \"charity\",\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: \"w6\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"edible\",\r\n    itemName: \"Muffins & Croissants\",\r\n    quantity: 20,\r\n    expiryDate: \"2025-12-08\",\r\n    status: \"pending\",\r\n    assignedTo: \"charity\",\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n  // Add more available items for farmer\r\n  {\r\n    id: \"w7\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"organic\",\r\n    itemName: \"Fruit Peels\",\r\n    quantity: 15,\r\n    expiryDate: \"2025-12-09\",\r\n    status: \"pending\",\r\n    assignedTo: \"farmer\",\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    id: \"w8\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"coffee\",\r\n    itemName: \"Used Coffee Grounds\",\r\n    quantity: 18,\r\n    expiryDate: \"2025-12-07\",\r\n    status: \"pending\",\r\n    assignedTo: \"farmer\",\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  },\r\n]\r\n\r\nexport const pickupRequests: PickupRequest[] = [\r\n  {\r\n    id: \"p1\",\r\n    wasteId: \"w1\",\r\n    requesterId: \"u-charity-1\",\r\n    requesterType: \"charity\",\r\n    requestedAt: \"2025-12-01T12:00:00Z\",\r\n    status: \"pending\",\r\n    preferredTime: \"Morning\",\r\n  },\r\n  {\r\n    id: \"p2\",\r\n    wasteId: \"w2\",\r\n    requesterId: \"u-farmer-1\",\r\n    requesterType: \"farmer\",\r\n    requestedAt: \"2025-12-01T13:00:00Z\",\r\n    status: \"approved\",\r\n  },\r\n  {\r\n    id: \"p3\",\r\n    wasteId: \"w3\",\r\n    requesterId: \"u-farmer-1\",\r\n    requesterType: \"farmer\",\r\n    requestedAt: \"2025-11-30T13:00:00Z\",\r\n    status: \"collected\",\r\n  },\r\n  // Add approved charity request\r\n  {\r\n    id: \"p4\",\r\n    wasteId: \"w5\",\r\n    requesterId: \"u-charity-1\",\r\n    requesterType: \"charity\",\r\n    requestedAt: new Date().toISOString(),\r\n    status: \"approved\",\r\n    notes: \"Please pack in boxes\",\r\n  },\r\n  // Add another approved charity request\r\n  {\r\n    id: \"p5\",\r\n    wasteId: \"w6\",\r\n    requesterId: \"u-charity-1\",\r\n    requesterType: \"charity\",\r\n    requestedAt: new Date().toISOString(),\r\n    status: \"approved\",\r\n  },\r\n  // Add approved farmer request\r\n  {\r\n    id: \"p6\",\r\n    wasteId: \"w7\",\r\n    requesterId: \"u-farmer-1\",\r\n    requesterType: \"farmer\",\r\n    requestedAt: new Date().toISOString(),\r\n    status: \"approved\",\r\n  },\r\n  // Add another approved farmer request\r\n  {\r\n    id: \"p7\",\r\n    wasteId: \"w8\",\r\n    requesterId: \"u-farmer-1\",\r\n    requesterType: \"farmer\",\r\n    requestedAt: new Date().toISOString(),\r\n    status: \"approved\",\r\n  },\r\n]\r\n\r\nexport const activityLogs: ActivityLog[] = [\r\n  {\r\n    id: \"a1\",\r\n    userId: \"u-staff-1\",\r\n    actionType: \"logged\",\r\n    itemName: \"Pastries\",\r\n    createdAt: \"2025-12-01T08:00:00Z\",\r\n  },\r\n  {\r\n    id: \"a2\",\r\n    userId: \"u-charity-1\",\r\n    actionType: \"donationRequested\",\r\n    itemName: \"Pastries\",\r\n    createdAt: \"2025-12-01T12:05:00Z\",\r\n  },\r\n  {\r\n    id: \"a3\",\r\n    userId: \"u-farmer-1\",\r\n    actionType: \"farmRequest\",\r\n    itemName: \"Vegetable Scraps\",\r\n    createdAt: \"2025-12-01T13:05:00Z\",\r\n  },\r\n  {\r\n    id: \"a4\",\r\n    userId: \"u-admin-1\",\r\n    actionType: \"dropped\",\r\n    itemName: \"Sandwiches\",\r\n    createdAt: \"2025-12-01T14:00:00Z\",\r\n  },\r\n]\r\n\r\nexport const transports: Transport[] = []\r\n\r\nexport const notifications: Notification[] = []\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 298, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/farmer/available/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { wasteLogs, pickupRequests, users } from \"@/app/api/_data\"\r\nimport type { WasteLog } from \"@/app/api/_types\"\r\n\r\ntype AvailableItem = {\r\n  id: string\r\n  cafeId: string\r\n  cafeName: string\r\n  itemName: string\r\n  type: string\r\n  quantity: number\r\n  expiryDate: string\r\n  status: string\r\n}\r\n\r\n// GET /api/farmer/available\r\n// Lists organic/coffee waste items assigned to farmer that are still pending and available for farms.\r\n// Only shows items that:\r\n// - Are assigned to \"farmer\"\r\n// - Have status \"pending\"\r\n// - Are not already requested (no pickup request exists for this waste)\r\n// Public endpoint - no authentication required\r\nexport async function GET(req: NextRequest) {\r\n  // Allow public access - no authentication required\r\n\r\n  // Get all waste IDs that have active pickup requests (pending or approved)\r\n  // Rejected requests should make items available again\r\n  const requestedWasteIds = new Set(\r\n    pickupRequests\r\n      .filter((p) => p.status === \"pending\" || p.status === \"approved\")\r\n      .map((p) => p.wasteId)\r\n  )\r\n\r\n  // Debug: Log all waste logs for troubleshooting\r\n  console.log(`[Farmer Available] Total waste logs: ${wasteLogs.length}`)\r\n  console.log(`[Farmer Available] Requested waste IDs: ${Array.from(requestedWasteIds).join(\", \") || \"none\"}`)\r\n  \r\n  // Log all organic/coffee items for debugging\r\n  const organicCoffeeItems = wasteLogs.filter(w => w.type === \"organic\" || w.type === \"coffee\")\r\n  console.log(`[Farmer Available] Organic/Coffee items found: ${organicCoffeeItems.length}`)\r\n  organicCoffeeItems.forEach(w => {\r\n    console.log(`  - ${w.itemName}: type=${w.type}, status=${w.status}, assignedTo=${w.assignedTo}, requested=${requestedWasteIds.has(w.id)}`)\r\n  })\r\n\r\n  const items: AvailableItem[] = wasteLogs\r\n    .filter(\r\n      (w) => {\r\n        const isOrganicOrCoffee = w.type === \"organic\" || w.type === \"coffee\"\r\n        const isPending = w.status === \"pending\"\r\n        const isAssignedToFarmer = w.assignedTo === \"farmer\"\r\n        const notRequested = !requestedWasteIds.has(w.id)\r\n        \r\n        const shouldInclude = isOrganicOrCoffee && isPending && isAssignedToFarmer && notRequested\r\n        \r\n        // Debug logging\r\n        if (shouldInclude) {\r\n          console.log(`[Farmer Available] ✅ Including item: ${w.itemName} (${w.type}, assignedTo: ${w.assignedTo}, status: ${w.status})`)\r\n        } else if (isOrganicOrCoffee) {\r\n          console.log(`[Farmer Available] ❌ Excluding item: ${w.itemName} (type: ${w.type}, assignedTo: ${w.assignedTo}, status: ${w.status}, requested: ${requestedWasteIds.has(w.id)})`)\r\n        }\r\n        \r\n        return shouldInclude\r\n      }\r\n    )\r\n    .map((w) => {\r\n      // Find cafe name from users\r\n      const cafeUser = users.find((u) => u.cafeId === w.cafeId)\r\n      return {\r\n        id: w.id,\r\n        cafeId: w.cafeId,\r\n        cafeName: cafeUser?.organizationName || \"Green Café\",\r\n        itemName: w.itemName,\r\n        type: w.type,\r\n        quantity: w.quantity,\r\n        expiryDate: w.expiryDate,\r\n        status: w.status,\r\n      }\r\n    })\r\n\r\n  console.log(`[Farmer Available] Returning ${items.length} items`)\r\n  return NextResponse.json(items)\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAqBO,eAAe,IAAI,GAAgB;IACxC,mDAAmD;IAEnD,2EAA2E;IAC3E,sDAAsD;IACtD,MAAM,oBAAoB,IAAI,IAC5B,+IAAc,CACX,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,aAAa,EAAE,MAAM,KAAK,YACrD,GAAG,CAAC,CAAC,IAAM,EAAE,OAAO;IAGzB,gDAAgD;IAChD,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,0IAAS,CAAC,MAAM,EAAE;IACtE,QAAQ,GAAG,CAAC,CAAC,wCAAwC,EAAE,MAAM,IAAI,CAAC,mBAAmB,IAAI,CAAC,SAAS,QAAQ;IAE3G,6CAA6C;IAC7C,MAAM,qBAAqB,0IAAS,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK,aAAa,EAAE,IAAI,KAAK;IACpF,QAAQ,GAAG,CAAC,CAAC,+CAA+C,EAAE,mBAAmB,MAAM,EAAE;IACzF,mBAAmB,OAAO,CAAC,CAAA;QACzB,QAAQ,GAAG,CAAC,CAAC,IAAI,EAAE,EAAE,QAAQ,CAAC,OAAO,EAAE,EAAE,IAAI,CAAC,SAAS,EAAE,EAAE,MAAM,CAAC,aAAa,EAAE,EAAE,UAAU,CAAC,YAAY,EAAE,kBAAkB,GAAG,CAAC,EAAE,EAAE,GAAG;IAC3I;IAEA,MAAM,QAAyB,0IAAS,CACrC,MAAM,CACL,CAAC;QACC,MAAM,oBAAoB,EAAE,IAAI,KAAK,aAAa,EAAE,IAAI,KAAK;QAC7D,MAAM,YAAY,EAAE,MAAM,KAAK;QAC/B,MAAM,qBAAqB,EAAE,UAAU,KAAK;QAC5C,MAAM,eAAe,CAAC,kBAAkB,GAAG,CAAC,EAAE,EAAE;QAEhD,MAAM,gBAAgB,qBAAqB,aAAa,sBAAsB;QAE9E,gBAAgB;QAChB,IAAI,eAAe;YACjB,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,cAAc,EAAE,EAAE,UAAU,CAAC,UAAU,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC;QAChI,OAAO,IAAI,mBAAmB;YAC5B,QAAQ,GAAG,CAAC,CAAC,qCAAqC,EAAE,EAAE,QAAQ,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,cAAc,EAAE,EAAE,UAAU,CAAC,UAAU,EAAE,EAAE,MAAM,CAAC,aAAa,EAAE,kBAAkB,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACjL;QAEA,OAAO;IACT,GAED,GAAG,CAAC,CAAC;QACJ,4BAA4B;QAC5B,MAAM,WAAW,sIAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,EAAE,MAAM;QACxD,OAAO;YACL,IAAI,EAAE,EAAE;YACR,QAAQ,EAAE,MAAM;YAChB,UAAU,UAAU,oBAAoB;YACxC,UAAU,EAAE,QAAQ;YACpB,MAAM,EAAE,IAAI;YACZ,UAAU,EAAE,QAAQ;YACpB,YAAY,EAAE,UAAU;YACxB,QAAQ,EAAE,MAAM;QAClB;IACF;IAEF,QAAQ,GAAG,CAAC,CAAC,6BAA6B,EAAE,MAAM,MAAM,CAAC,MAAM,CAAC;IAChE,OAAO,wJAAY,CAAC,IAAI,CAAC;AAC3B","debugId":null}}]
}