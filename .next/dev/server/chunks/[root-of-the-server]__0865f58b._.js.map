{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/_data.ts"],"sourcesContent":["import type { User, WasteLog, PickupRequest, ActivityLog } from \"./_types\"\r\n\r\n// Dummy users (in-memory). Use x-user-id header to pick one.\r\nexport const users: User[] = [\r\n  {\r\n    id: \"u-admin-1\",\r\n    name: \"Alice Admin\",\r\n    email: \"alice@greencafe.com\",\r\n    passwordHash: \"password\", // TODO: hash passwords\r\n    role: \"admin\",\r\n    organizationName: \"Green Café\",\r\n    cafeId: \"cafe-1\",\r\n  },\r\n  {\r\n    id: \"u-staff-1\",\r\n    name: \"Sam Staff\",\r\n    email: \"sam@greencafe.com\",\r\n    passwordHash: \"password\",\r\n    role: \"staff\",\r\n    organizationName: \"Green Café\",\r\n    cafeId: \"cafe-1\",\r\n  },\r\n  {\r\n    id: \"u-charity-1\",\r\n    name: \"Charlie Charity\",\r\n    email: \"charity@help.org\",\r\n    passwordHash: \"password\",\r\n    role: \"charity\",\r\n    organizationName: \"Hope Charity\",\r\n    cafeId: null,\r\n  },\r\n  {\r\n    id: \"u-farmer-1\",\r\n    name: \"Fiona Farmer\",\r\n    email: \"farm@soil.com\",\r\n    passwordHash: \"password\",\r\n    role: \"farmer\",\r\n    organizationName: \"Soil & Co\",\r\n    cafeId: null,\r\n  },\r\n]\r\n\r\nexport const wasteLogs: WasteLog[] = [\r\n  {\r\n    id: \"w1\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"edible\",\r\n    itemName: \"Pastries\",\r\n    quantity: 15,\r\n    expiryDate: \"2025-12-05\",\r\n    status: \"pending\",\r\n    assignedTo: \"charity\",\r\n    createdAt: \"2025-12-01T08:00:00Z\",\r\n    updatedAt: \"2025-12-01T08:00:00Z\",\r\n  },\r\n  {\r\n    id: \"w2\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"organic\",\r\n    itemName: \"Vegetable Scraps\",\r\n    quantity: 22,\r\n    expiryDate: \"2025-12-04\",\r\n    status: \"pending\",\r\n    assignedTo: \"farmer\",\r\n    createdAt: \"2025-12-01T09:00:00Z\",\r\n    updatedAt: \"2025-12-01T09:00:00Z\",\r\n  },\r\n  {\r\n    id: \"w3\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"coffee\",\r\n    itemName: \"Coffee Grounds\",\r\n    quantity: 10,\r\n    expiryDate: \"2025-12-03\",\r\n    status: \"collected\",\r\n    assignedTo: \"farmer\",\r\n    createdAt: \"2025-11-30T10:00:00Z\",\r\n    updatedAt: \"2025-12-01T10:00:00Z\",\r\n  },\r\n  {\r\n    id: \"w4\",\r\n    cafeId: \"cafe-1\",\r\n    type: \"edible\",\r\n    itemName: \"Sandwiches\",\r\n    quantity: 8,\r\n    expiryDate: \"2025-12-02\",\r\n    status: \"dropped\",\r\n    assignedTo: \"charity\",\r\n    createdAt: \"2025-11-30T11:00:00Z\",\r\n    updatedAt: \"2025-12-01T11:00:00Z\",\r\n  },\r\n]\r\n\r\nexport const pickupRequests: PickupRequest[] = [\r\n  {\r\n    id: \"p1\",\r\n    wasteId: \"w1\",\r\n    requesterId: \"u-charity-1\",\r\n    requesterType: \"charity\",\r\n    requestedAt: \"2025-12-01T12:00:00Z\",\r\n    status: \"pending\",\r\n    preferredTime: \"Morning\",\r\n  },\r\n  {\r\n    id: \"p2\",\r\n    wasteId: \"w2\",\r\n    requesterId: \"u-farmer-1\",\r\n    requesterType: \"farmer\",\r\n    requestedAt: \"2025-12-01T13:00:00Z\",\r\n    status: \"approved\",\r\n  },\r\n  {\r\n    id: \"p3\",\r\n    wasteId: \"w3\",\r\n    requesterId: \"u-farmer-1\",\r\n    requesterType: \"farmer\",\r\n    requestedAt: \"2025-11-30T13:00:00Z\",\r\n    status: \"collected\",\r\n  },\r\n]\r\n\r\nexport const activityLogs: ActivityLog[] = [\r\n  {\r\n    id: \"a1\",\r\n    userId: \"u-staff-1\",\r\n    actionType: \"logged\",\r\n    itemName: \"Pastries\",\r\n    createdAt: \"2025-12-01T08:00:00Z\",\r\n  },\r\n  {\r\n    id: \"a2\",\r\n    userId: \"u-charity-1\",\r\n    actionType: \"donationRequested\",\r\n    itemName: \"Pastries\",\r\n    createdAt: \"2025-12-01T12:05:00Z\",\r\n  },\r\n  {\r\n    id: \"a3\",\r\n    userId: \"u-farmer-1\",\r\n    actionType: \"farmRequest\",\r\n    itemName: \"Vegetable Scraps\",\r\n    createdAt: \"2025-12-01T13:05:00Z\",\r\n  },\r\n  {\r\n    id: \"a4\",\r\n    userId: \"u-admin-1\",\r\n    actionType: \"dropped\",\r\n    itemName: \"Sandwiches\",\r\n    createdAt: \"2025-12-01T14:00:00Z\",\r\n  },\r\n]\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAGO,MAAM,QAAgB;IAC3B;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,cAAc;QACd,MAAM;QACN,kBAAkB;QAClB,QAAQ;IACV;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,cAAc;QACd,MAAM;QACN,kBAAkB;QAClB,QAAQ;IACV;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,cAAc;QACd,MAAM;QACN,kBAAkB;QAClB,QAAQ;IACV;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,cAAc;QACd,MAAM;QACN,kBAAkB;QAClB,QAAQ;IACV;CACD;AAEM,MAAM,YAAwB;IACnC;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,UAAU;QACV,UAAU;QACV,YAAY;QACZ,QAAQ;QACR,YAAY;QACZ,WAAW;QACX,WAAW;IACb;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,UAAU;QACV,UAAU;QACV,YAAY;QACZ,QAAQ;QACR,YAAY;QACZ,WAAW;QACX,WAAW;IACb;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,UAAU;QACV,UAAU;QACV,YAAY;QACZ,QAAQ;QACR,YAAY;QACZ,WAAW;QACX,WAAW;IACb;IACA;QACE,IAAI;QACJ,QAAQ;QACR,MAAM;QACN,UAAU;QACV,UAAU;QACV,YAAY;QACZ,QAAQ;QACR,YAAY;QACZ,WAAW;QACX,WAAW;IACb;CACD;AAEM,MAAM,iBAAkC;IAC7C;QACE,IAAI;QACJ,SAAS;QACT,aAAa;QACb,eAAe;QACf,aAAa;QACb,QAAQ;QACR,eAAe;IACjB;IACA;QACE,IAAI;QACJ,SAAS;QACT,aAAa;QACb,eAAe;QACf,aAAa;QACb,QAAQ;IACV;IACA;QACE,IAAI;QACJ,SAAS;QACT,aAAa;QACb,eAAe;QACf,aAAa;QACb,QAAQ;IACV;CACD;AAEM,MAAM,eAA8B;IACzC;QACE,IAAI;QACJ,QAAQ;QACR,YAAY;QACZ,UAAU;QACV,WAAW;IACb;IACA;QACE,IAAI;QACJ,QAAQ;QACR,YAAY;QACZ,UAAU;QACV,WAAW;IACb;IACA;QACE,IAAI;QACJ,QAAQ;QACR,YAAY;QACZ,UAAU;QACV,WAAW;IACb;IACA;QACE,IAAI;QACJ,QAAQ;QACR,YAAY;QACZ,UAAU;QACV,WAAW;IACb;CACD","debugId":null}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/_auth.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { users } from \"./_data\"\r\nimport type { User } from \"./_types\"\r\n\r\n// Simple helper to get a user from the x-user-id header.\r\nexport function getUser(req: NextRequest): User | null {\r\n  const userId = req.headers.get(\"x-user-id\")\r\n  if (!userId) return null\r\n  return users.find((u) => u.id === userId) || null\r\n}\r\n\r\ntype GuardResult = { user: User | null; response: NextResponse | null }\r\n\r\nfunction requireRole(req: NextRequest, role: User[\"role\"]): GuardResult {\r\n  const user = getUser(req)\r\n  if (!user) {\r\n    return { user: null, response: NextResponse.json({ error: \"Unauthorized\" }, { status: 401 }) }\r\n  }\r\n  if (user.role !== role) {\r\n    return {\r\n      user: null,\r\n      response: NextResponse.json({ error: `Forbidden: ${role} only` }, { status: 403 }),\r\n    }\r\n  }\r\n  return { user, response: null }\r\n}\r\n\r\nexport function requireAdmin(req: NextRequest) {\r\n  const base = requireRole(req, \"admin\")\r\n  if (!base.user || base.response) return base\r\n  if (!base.user.cafeId) {\r\n    return { user: null, response: NextResponse.json({ error: \"Admin has no cafe assigned\" }, { status: 400 }) }\r\n  }\r\n  return base\r\n}\r\n\r\nexport function requireStaff(req: NextRequest) {\r\n  const base = requireRole(req, \"staff\")\r\n  if (!base.user || base.response) return base\r\n  if (!base.user.cafeId) {\r\n    return { user: null, response: NextResponse.json({ error: \"Staff has no cafe assigned\" }, { status: 400 }) }\r\n  }\r\n  return base\r\n}\r\n\r\nexport function requireCharity(req: NextRequest) {\r\n  return requireRole(req, \"charity\")\r\n}\r\n\r\nexport function requireFarmer(req: NextRequest) {\r\n  return requireRole(req, \"farmer\")\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAIO,SAAS,QAAQ,GAAgB;IACtC,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;IAC/B,IAAI,CAAC,QAAQ,OAAO;IACpB,OAAO,sIAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,WAAW;AAC/C;AAIA,SAAS,YAAY,GAAgB,EAAE,IAAkB;IACvD,MAAM,OAAO,QAAQ;IACrB,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,MAAM;YAAM,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC/F;IACA,IAAI,KAAK,IAAI,KAAK,MAAM;QACtB,OAAO;YACL,MAAM;YACN,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,CAAC,WAAW,EAAE,KAAK,KAAK,CAAC;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAClF;IACF;IACA,OAAO;QAAE;QAAM,UAAU;IAAK;AAChC;AAEO,SAAS,aAAa,GAAgB;IAC3C,MAAM,OAAO,YAAY,KAAK;IAC9B,IAAI,CAAC,KAAK,IAAI,IAAI,KAAK,QAAQ,EAAE,OAAO;IACxC,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,EAAE;QACrB,OAAO;YAAE,MAAM;YAAM,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC7G;IACA,OAAO;AACT;AAEO,SAAS,aAAa,GAAgB;IAC3C,MAAM,OAAO,YAAY,KAAK;IAC9B,IAAI,CAAC,KAAK,IAAI,IAAI,KAAK,QAAQ,EAAE,OAAO;IACxC,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,EAAE;QACrB,OAAO;YAAE,MAAM;YAAM,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC7G;IACA,OAAO;AACT;AAEO,SAAS,eAAe,GAAgB;IAC7C,OAAO,YAAY,KAAK;AAC1B;AAEO,SAAS,cAAc,GAAgB;IAC5C,OAAO,YAAY,KAAK;AAC1B","debugId":null}},
    {"offset": {"line": 293, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/farmer/requests/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\n\r\nimport { requireFarmer } from \"@/app/api/_auth\"\r\nimport { activityLogs, pickupRequests, wasteLogs } from \"@/app/api/_data\"\r\nimport type { PickupRequest } from \"@/app/api/_types\"\r\n\r\ntype CreateRequestBody = {\r\n  wasteId: string\r\n  requesterId: string\r\n  preferredTime?: string\r\n  notes?: string\r\n}\r\n\r\n// GET /api/farmer/requests\r\n// Returns pickup requests created by the farmer user (sorted by newest first).\r\nexport async function GET(req: NextRequest) {\r\n  const { user, response } = requireFarmer(req)\r\n  if (!user || response) return response!\r\n\r\n  const items = pickupRequests\r\n    .filter((p) => p.requesterId === user.id && p.requesterType === \"farmer\")\r\n    .sort((a, b) => b.requestedAt.localeCompare(a.requestedAt))\r\n\r\n  return NextResponse.json(items)\r\n}\r\n\r\n// POST /api/farmer/requests\r\n// Creates a pickup request for an organic/coffee pending waste item.\r\nexport async function POST(req: NextRequest) {\r\n  const { user, response } = requireFarmer(req)\r\n  if (!user || response) return response!\r\n\r\n  const body = (await req.json()) as Partial<CreateRequestBody>\r\n  if (!body.wasteId || !body.requesterId) {\r\n    return NextResponse.json({ error: \"Missing wasteId or requesterId\" }, { status: 400 })\r\n  }\r\n\r\n  if (body.requesterId !== user.id) {\r\n    return NextResponse.json({ error: \"Forbidden: requesterId must match authenticated user\" }, { status: 403 })\r\n  }\r\n\r\n  const waste = wasteLogs.find((w) => w.id === body.wasteId)\r\n  if (!waste) {\r\n    return NextResponse.json({ error: \"Waste item not found\" }, { status: 404 })\r\n  }\r\n\r\n  // Validate waste is available for farmer\r\n  if (\r\n    !((waste.type === \"organic\" || waste.type === \"coffee\") && \r\n      waste.status === \"pending\" && \r\n      waste.assignedTo === \"farmer\")\r\n  ) {\r\n    return NextResponse.json({ error: \"Waste item is not available for farm pickup\" }, { status: 400 })\r\n  }\r\n\r\n  // Check if this waste already has a pickup request\r\n  const existingRequest = pickupRequests.find((p) => p.wasteId === waste.id)\r\n  if (existingRequest) {\r\n    return NextResponse.json({ error: \"This waste item already has a pickup request\" }, { status: 400 })\r\n  }\r\n\r\n  const now = new Date().toISOString()\r\n  const newRequest: PickupRequest = {\r\n    id: `p-${Date.now()}`,\r\n    wasteId: waste.id,\r\n    requesterId: user.id,\r\n    requesterType: \"farmer\",\r\n    requestedAt: now,\r\n    status: \"pending\",\r\n    preferredTime: body.preferredTime,\r\n    notes: body.notes,\r\n  }\r\n\r\n  pickupRequests.push(newRequest)\r\n\r\n  // Add activity log with pickupRequested action\r\n  activityLogs.push({\r\n    id: `a-${Date.now()}`,\r\n    userId: user.id,\r\n    actionType: \"pickupRequested\",\r\n    itemName: waste.itemName,\r\n    requesterType: \"farmer\",\r\n    createdAt: now,\r\n  })\r\n\r\n  return NextResponse.json(newRequest, { status: 201 })\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;;;;AAYO,eAAe,IAAI,GAAgB;IACxC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,IAAA,8IAAa,EAAC;IACzC,IAAI,CAAC,QAAQ,UAAU,OAAO;IAE9B,MAAM,QAAQ,+IAAc,CACzB,MAAM,CAAC,CAAC,IAAM,EAAE,WAAW,KAAK,KAAK,EAAE,IAAI,EAAE,aAAa,KAAK,UAC/D,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,WAAW,CAAC,aAAa,CAAC,EAAE,WAAW;IAE3D,OAAO,wJAAY,CAAC,IAAI,CAAC;AAC3B;AAIO,eAAe,KAAK,GAAgB;IACzC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,IAAA,8IAAa,EAAC;IACzC,IAAI,CAAC,QAAQ,UAAU,OAAO;IAE9B,MAAM,OAAQ,MAAM,IAAI,IAAI;IAC5B,IAAI,CAAC,KAAK,OAAO,IAAI,CAAC,KAAK,WAAW,EAAE;QACtC,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiC,GAAG;YAAE,QAAQ;QAAI;IACtF;IAEA,IAAI,KAAK,WAAW,KAAK,KAAK,EAAE,EAAE;QAChC,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuD,GAAG;YAAE,QAAQ;QAAI;IAC5G;IAEA,MAAM,QAAQ,0IAAS,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK,OAAO;IACzD,IAAI,CAAC,OAAO;QACV,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;IAEA,yCAAyC;IACzC,IACE,CAAC,CAAC,CAAC,MAAM,IAAI,KAAK,aAAa,MAAM,IAAI,KAAK,QAAQ,KACpD,MAAM,MAAM,KAAK,aACjB,MAAM,UAAU,KAAK,QAAQ,GAC/B;QACA,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8C,GAAG;YAAE,QAAQ;QAAI;IACnG;IAEA,mDAAmD;IACnD,MAAM,kBAAkB,+IAAc,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK,MAAM,EAAE;IACzE,IAAI,iBAAiB;QACnB,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+C,GAAG;YAAE,QAAQ;QAAI;IACpG;IAEA,MAAM,MAAM,IAAI,OAAO,WAAW;IAClC,MAAM,aAA4B;QAChC,IAAI,CAAC,EAAE,EAAE,KAAK,GAAG,IAAI;QACrB,SAAS,MAAM,EAAE;QACjB,aAAa,KAAK,EAAE;QACpB,eAAe;QACf,aAAa;QACb,QAAQ;QACR,eAAe,KAAK,aAAa;QACjC,OAAO,KAAK,KAAK;IACnB;IAEA,+IAAc,CAAC,IAAI,CAAC;IAEpB,+CAA+C;IAC/C,6IAAY,CAAC,IAAI,CAAC;QAChB,IAAI,CAAC,EAAE,EAAE,KAAK,GAAG,IAAI;QACrB,QAAQ,KAAK,EAAE;QACf,YAAY;QACZ,UAAU,MAAM,QAAQ;QACxB,eAAe;QACf,WAAW;IACb;IAEA,OAAO,wJAAY,CAAC,IAAI,CAAC,YAAY;QAAE,QAAQ;IAAI;AACrD","debugId":null}}]
}