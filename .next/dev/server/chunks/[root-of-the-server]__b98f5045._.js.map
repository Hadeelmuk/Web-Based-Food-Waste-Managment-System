{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/_data.ts"],"sourcesContent":["import type { User, WasteLog, PickupRequest, ActivityLog, Transport, Notification } from \"./_types\"\n\n// Dummy users (in-memory). Use x-user-id header to pick one.\nexport const users: User[] = [\n  {\n    id: \"u-admin-1\",\n    name: \"Alice Admin\",\n    email: \"alice@greencafe.com\",\n    passwordHash: \"password\", // TODO: hash passwords\n    role: \"admin\",\n    organizationName: \"Green Café\",\n    cafeId: \"cafe-1\",\n  },\n  {\n    id: \"u-staff-1\",\n    name: \"Sam Staff\",\n    email: \"sam@greencafe.com\",\n    passwordHash: \"password\",\n    role: \"staff\",\n    organizationName: \"Green Café\",\n    cafeId: \"cafe-1\",\n  },\n  {\n    id: \"u-charity-1\",\n    name: \"Charlie Charity\",\n    email: \"charity@help.org\",\n    passwordHash: \"password\",\n    role: \"charity\",\n    organizationName: \"Hope Charity\",\n    cafeId: null,\n  },\n  {\n    id: \"u-farmer-1\",\n    name: \"Fiona Farmer\",\n    email: \"farm@soil.com\",\n    passwordHash: \"password\",\n    role: \"farmer\",\n    organizationName: \"Soil & Co\",\n    cafeId: null,\n  },\n]\n\nexport const wasteLogs: WasteLog[] = [\n  {\n    id: \"w1\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Pastries\",\n    quantity: 15,\n    expiryDate: \"2025-12-05\",\n    status: \"pending\",\n    assignedTo: \"charity\",\n    createdAt: \"2025-12-01T08:00:00Z\",\n    updatedAt: \"2025-12-01T08:00:00Z\",\n  },\n  {\n    id: \"w2\",\n    cafeId: \"cafe-1\",\n    type: \"organic\",\n    itemName: \"Vegetable Scraps\",\n    quantity: 22,\n    expiryDate: \"2025-12-04\",\n    status: \"pending\",\n    assignedTo: \"farmer\",\n    createdAt: \"2025-12-01T09:00:00Z\",\n    updatedAt: \"2025-12-01T09:00:00Z\",\n  },\n  {\n    id: \"w3\",\n    cafeId: \"cafe-1\",\n    type: \"coffee\",\n    itemName: \"Coffee Grounds\",\n    quantity: 10,\n    expiryDate: \"2025-12-03\",\n    status: \"collected\",\n    assignedTo: \"farmer\",\n    createdAt: \"2025-11-30T10:00:00Z\",\n    updatedAt: \"2025-12-01T10:00:00Z\",\n  },\n  {\n    id: \"w4\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Sandwiches\",\n    quantity: 8,\n    expiryDate: \"2025-12-02\",\n    status: \"dropped\",\n    assignedTo: \"charity\",\n    createdAt: \"2025-11-30T11:00:00Z\",\n    updatedAt: \"2025-12-01T11:00:00Z\",\n  },\n  // Add more available items for charity\n  {\n    id: \"w5\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Fresh Bread\",\n    quantity: 12,\n    expiryDate: \"2025-12-10\",\n    status: \"pending\",\n    assignedTo: \"charity\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: \"w6\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Muffins & Croissants\",\n    quantity: 20,\n    expiryDate: \"2025-12-08\",\n    status: \"pending\",\n    assignedTo: \"charity\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  // Add more available items for farmer\n  {\n    id: \"w7\",\n    cafeId: \"cafe-1\",\n    type: \"organic\",\n    itemName: \"Fruit Peels\",\n    quantity: 15,\n    expiryDate: \"2025-12-09\",\n    status: \"pending\",\n    assignedTo: \"farmer\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: \"w8\",\n    cafeId: \"cafe-1\",\n    type: \"coffee\",\n    itemName: \"Used Coffee Grounds\",\n    quantity: 18,\n    expiryDate: \"2025-12-07\",\n    status: \"pending\",\n    assignedTo: \"farmer\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  // Add NEW farmer items WITHOUT pickup requests (these will be available)\n  {\n    id: \"w9\",\n    cafeId: \"cafe-1\",\n    type: \"organic\",\n    itemName: \"Banana Peels\",\n    quantity: 25,\n    expiryDate: \"2025-12-20\",\n    status: \"pending\",\n    assignedTo: \"farmer\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: \"w10\",\n    cafeId: \"cafe-1\",\n    type: \"coffee\",\n    itemName: \"Fresh Coffee Grounds\",\n    quantity: 30,\n    expiryDate: \"2025-12-18\",\n    status: \"pending\",\n    assignedTo: \"farmer\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: \"w11\",\n    cafeId: \"cafe-1\",\n    type: \"organic\",\n    itemName: \"Vegetable Waste\",\n    quantity: 35,\n    expiryDate: \"2025-12-25\",\n    status: \"pending\",\n    assignedTo: \"farmer\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  // Add NEW charity items WITHOUT pickup requests (these will be available)\n  {\n    id: \"w12\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Fresh Sandwiches\",\n    quantity: 18,\n    expiryDate: \"2025-12-20\",\n    status: \"pending\",\n    assignedTo: \"charity\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: \"w13\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Day-Old Pastries\",\n    quantity: 22,\n    expiryDate: \"2025-12-19\",\n    status: \"pending\",\n    assignedTo: \"charity\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n  {\n    id: \"w14\",\n    cafeId: \"cafe-1\",\n    type: \"edible\",\n    itemName: \"Leftover Meals\",\n    quantity: 15,\n    expiryDate: \"2025-12-22\",\n    status: \"pending\",\n    assignedTo: \"charity\",\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n  },\n]\n\nexport const pickupRequests: PickupRequest[] = [\n  {\n    id: \"p1\",\n    wasteId: \"w1\",\n    requesterId: \"u-charity-1\",\n    requesterType: \"charity\",\n    requestedAt: \"2025-12-01T12:00:00Z\",\n    status: \"pending\",\n    preferredTime: \"Morning\",\n  },\n  {\n    id: \"p2\",\n    wasteId: \"w2\",\n    requesterId: \"u-farmer-1\",\n    requesterType: \"farmer\",\n    requestedAt: \"2025-12-01T13:00:00Z\",\n    status: \"approved\",\n  },\n  {\n    id: \"p3\",\n    wasteId: \"w3\",\n    requesterId: \"u-farmer-1\",\n    requesterType: \"farmer\",\n    requestedAt: \"2025-11-30T13:00:00Z\",\n    status: \"collected\",\n  },\n  // Add approved charity request\n  {\n    id: \"p4\",\n    wasteId: \"w5\",\n    requesterId: \"u-charity-1\",\n    requesterType: \"charity\",\n    requestedAt: new Date().toISOString(),\n    status: \"approved\",\n    notes: \"Please pack in boxes\",\n  },\n  // Add another approved charity request\n  {\n    id: \"p5\",\n    wasteId: \"w6\",\n    requesterId: \"u-charity-1\",\n    requesterType: \"charity\",\n    requestedAt: new Date().toISOString(),\n    status: \"approved\",\n  },\n  // Add approved farmer request\n  {\n    id: \"p6\",\n    wasteId: \"w7\",\n    requesterId: \"u-farmer-1\",\n    requesterType: \"farmer\",\n    requestedAt: new Date().toISOString(),\n    status: \"approved\",\n  },\n  // Add another approved farmer request\n  {\n    id: \"p7\",\n    wasteId: \"w8\",\n    requesterId: \"u-farmer-1\",\n    requesterType: \"farmer\",\n    requestedAt: new Date().toISOString(),\n    status: \"approved\",\n  },\n]\n\nexport const activityLogs: ActivityLog[] = [\n  {\n    id: \"a1\",\n    userId: \"u-staff-1\",\n    actionType: \"logged\",\n    itemName: \"Pastries\",\n    createdAt: \"2025-12-01T08:00:00Z\",\n  },\n  {\n    id: \"a2\",\n    userId: \"u-charity-1\",\n    actionType: \"donationRequested\",\n    itemName: \"Pastries\",\n    createdAt: \"2025-12-01T12:05:00Z\",\n  },\n  {\n    id: \"a3\",\n    userId: \"u-farmer-1\",\n    actionType: \"farmRequest\",\n    itemName: \"Vegetable Scraps\",\n    createdAt: \"2025-12-01T13:05:00Z\",\n  },\n  {\n    id: \"a4\",\n    userId: \"u-admin-1\",\n    actionType: \"dropped\",\n    itemName: \"Sandwiches\",\n    createdAt: \"2025-12-01T14:00:00Z\",\n  },\n]\n\nexport const transports: Transport[] = []\n\nexport const notifications: Notification[] = []\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 372, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/_auth.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { users } from \"./_data\"\r\nimport type { User } from \"./_types\"\r\n\r\n// Simple helper to get a user from the x-user-id header.\r\nexport function getUser(req: NextRequest): User | null {\r\n  const userId = req.headers.get(\"x-user-id\")\r\n  if (!userId) return null\r\n  return users.find((u) => u.id === userId) || null\r\n}\r\n\r\ntype GuardResult = { user: User | null; response: NextResponse | null }\r\n\r\nfunction requireRole(req: NextRequest, role: User[\"role\"]): GuardResult {\r\n  const user = getUser(req)\r\n  if (!user) {\r\n    return { user: null, response: NextResponse.json({ error: \"Unauthorized\" }, { status: 401 }) }\r\n  }\r\n  if (user.role !== role) {\r\n    return {\r\n      user: null,\r\n      response: NextResponse.json({ error: `Forbidden: ${role} only` }, { status: 403 }),\r\n    }\r\n  }\r\n  return { user, response: null }\r\n}\r\n\r\nexport function requireAdmin(req: NextRequest) {\r\n  const base = requireRole(req, \"admin\")\r\n  if (!base.user || base.response) return base\r\n  if (!base.user.cafeId) {\r\n    return { user: null, response: NextResponse.json({ error: \"Admin has no cafe assigned\" }, { status: 400 }) }\r\n  }\r\n  return base\r\n}\r\n\r\nexport function requireStaff(req: NextRequest) {\r\n  const base = requireRole(req, \"staff\")\r\n  if (!base.user || base.response) return base\r\n  if (!base.user.cafeId) {\r\n    return { user: null, response: NextResponse.json({ error: \"Staff has no cafe assigned\" }, { status: 400 }) }\r\n  }\r\n  return base\r\n}\r\n\r\nexport function requireCharity(req: NextRequest) {\r\n  return requireRole(req, \"charity\")\r\n}\r\n\r\nexport function requireFarmer(req: NextRequest) {\r\n  return requireRole(req, \"farmer\")\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAIO,SAAS,QAAQ,GAAgB;IACtC,MAAM,SAAS,IAAI,OAAO,CAAC,GAAG,CAAC;IAC/B,IAAI,CAAC,QAAQ,OAAO;IACpB,OAAO,sIAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,WAAW;AAC/C;AAIA,SAAS,YAAY,GAAgB,EAAE,IAAkB;IACvD,MAAM,OAAO,QAAQ;IACrB,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,MAAM;YAAM,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC/F;IACA,IAAI,KAAK,IAAI,KAAK,MAAM;QACtB,OAAO;YACL,MAAM;YACN,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,CAAC,WAAW,EAAE,KAAK,KAAK,CAAC;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAClF;IACF;IACA,OAAO;QAAE;QAAM,UAAU;IAAK;AAChC;AAEO,SAAS,aAAa,GAAgB;IAC3C,MAAM,OAAO,YAAY,KAAK;IAC9B,IAAI,CAAC,KAAK,IAAI,IAAI,KAAK,QAAQ,EAAE,OAAO;IACxC,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,EAAE;QACrB,OAAO;YAAE,MAAM;YAAM,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC7G;IACA,OAAO;AACT;AAEO,SAAS,aAAa,GAAgB;IAC3C,MAAM,OAAO,YAAY,KAAK;IAC9B,IAAI,CAAC,KAAK,IAAI,IAAI,KAAK,QAAQ,EAAE,OAAO;IACxC,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,EAAE;QACrB,OAAO;YAAE,MAAM;YAAM,UAAU,wJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAAG;IAC7G;IACA,OAAO;AACT;AAEO,SAAS,eAAe,GAAgB;IAC7C,OAAO,YAAY,KAAK;AAC1B;AAEO,SAAS,cAAc,GAAgB;IAC5C,OAAO,YAAY,KAAK;AAC1B","debugId":null}},
    {"offset": {"line": 460, "column": 0}, "map": {"version":3,"sources":["file:///D:/CS%20Y3/FYP/FWMS/FWMS/app/api/admin/pickups/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\n\r\nimport { requireAdmin } from \"@/app/api/_auth\"\r\nimport { activityLogs, pickupRequests, wasteLogs } from \"@/app/api/_data\"\r\n\r\nimport { users } from \"@/app/api/_data\"\r\n\r\ntype PickupDto = {\r\n  id: string\r\n  wasteId: string\r\n  requesterId: string\r\n  requesterName: string\r\n  requesterType: \"charity\" | \"farmer\"\r\n  itemName: string\r\n  itemType: string\r\n  quantity: number\r\n  status: string\r\n  dateRequested: string\r\n  preferredTime?: string\r\n  notes?: string\r\n}\r\n\r\n// GET /api/admin/pickups\r\n// Lists all pickup requests for waste items belonging to the admin's café.\r\n// Shows full details including requester name and waste item info.\r\nexport async function GET(req: NextRequest) {\r\n  const { user, response } = requireAdmin(req)\r\n  if (!user || response) return response!\r\n\r\n  const items: PickupDto[] = pickupRequests\r\n    .map((p) => {\r\n      const waste = wasteLogs.find((w) => w.id === p.wasteId)\r\n      if (!waste || waste.cafeId !== user.cafeId) return null\r\n\r\n      const requester = users.find((u) => u.id === p.requesterId)\r\n\r\n      return {\r\n        id: p.id, // IMPORTANT: This is the pickupRequest.id (e.g., \"p1\"), NOT wasteId\r\n        wasteId: p.wasteId, // This is the waste ID (e.g., \"w1\") - included for reference only\r\n        requesterId: p.requesterId,\r\n        requesterName: requester?.name || \"Unknown\",\r\n        requesterType: p.requesterType,\r\n        itemName: waste.itemName,\r\n        itemType: waste.type,\r\n        quantity: waste.quantity,\r\n        status: p.status,\r\n        dateRequested: p.requestedAt,\r\n        preferredTime: p.preferredTime,\r\n        notes: p.notes,\r\n      }\r\n    })\r\n    .filter(Boolean) as PickupDto[]\r\n\r\n  return NextResponse.json(items)\r\n}\r\n\r\ntype UpdateBody = {\r\n  status: \"approve\" | \"reject\" | \"collect\"\r\n}\r\n\r\n// PATCH /api/admin/pickups?id=pickupId\r\n// Allows admin to approve, reject, or mark a pickup as collected.\r\nexport async function PATCH(req: NextRequest) {\r\n  const { user, response } = requireAdmin(req)\r\n  if (!user || response) return response!\r\n\r\n  const pickupId = new URL(req.url).searchParams.get(\"id\")\r\n  if (!pickupId) {\r\n    return NextResponse.json({ error: \"Missing pickup request id\" }, { status: 400 })\r\n  }\r\n\r\n  const body = (await req.json()) as Partial<UpdateBody>\r\n  if (!body.status) {\r\n    return NextResponse.json({ error: \"Missing status\" }, { status: 400 })\r\n  }\r\n\r\n  const pickup = pickupRequests.find((p) => p.id === pickupId)\r\n  if (!pickup) {\r\n    return NextResponse.json({ error: \"Pickup request not found\" }, { status: 404 })\r\n  }\r\n\r\n  const waste = wasteLogs.find((w) => w.id === pickup.wasteId)\r\n  if (!waste || waste.cafeId !== user.cafeId) {\r\n    return NextResponse.json({ error: \"Forbidden: waste does not belong to your cafe\" }, { status: 403 })\r\n  }\r\n\r\n  const now = new Date().toISOString()\r\n\r\n  if (body.status === \"approve\") {\r\n    pickup.status = \"approved\"\r\n    // Waste stays \"pending\" until actually collected\r\n    activityLogs.push({\r\n      id: `a-${Date.now()}`,\r\n      userId: user.id,\r\n      actionType: \"approved\",\r\n      itemName: waste.itemName,\r\n      createdAt: now,\r\n    })\r\n  } else if (body.status === \"reject\") {\r\n    pickup.status = \"rejected\"\r\n    activityLogs.push({\r\n      id: `a-${Date.now()}`,\r\n      userId: user.id,\r\n      actionType: \"rejected\",\r\n      itemName: waste.itemName,\r\n      createdAt: now,\r\n    })\r\n  } else if (body.status === \"collect\") {\r\n    pickup.status = \"collected\"\r\n    waste.status = \"collected\"\r\n    waste.updatedAt = now\r\n    activityLogs.push({\r\n      id: `a-${Date.now()}`,\r\n      userId: user.id,\r\n      actionType: \"collected\",\r\n      itemName: waste.itemName,\r\n      createdAt: now,\r\n    })\r\n  }\r\n\r\n  return NextResponse.json({ pickup, waste })\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;;;;;AAsBO,eAAe,IAAI,GAAgB;IACxC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,IAAA,6IAAY,EAAC;IACxC,IAAI,CAAC,QAAQ,UAAU,OAAO;IAE9B,MAAM,QAAqB,+IAAc,CACtC,GAAG,CAAC,CAAC;QACJ,MAAM,QAAQ,0IAAS,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,EAAE,OAAO;QACtD,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,KAAK,MAAM,EAAE,OAAO;QAEnD,MAAM,YAAY,sIAAK,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,EAAE,WAAW;QAE1D,OAAO;YACL,IAAI,EAAE,EAAE;YACR,SAAS,EAAE,OAAO;YAClB,aAAa,EAAE,WAAW;YAC1B,eAAe,WAAW,QAAQ;YAClC,eAAe,EAAE,aAAa;YAC9B,UAAU,MAAM,QAAQ;YACxB,UAAU,MAAM,IAAI;YACpB,UAAU,MAAM,QAAQ;YACxB,QAAQ,EAAE,MAAM;YAChB,eAAe,EAAE,WAAW;YAC5B,eAAe,EAAE,aAAa;YAC9B,OAAO,EAAE,KAAK;QAChB;IACF,GACC,MAAM,CAAC;IAEV,OAAO,wJAAY,CAAC,IAAI,CAAC;AAC3B;AAQO,eAAe,MAAM,GAAgB;IAC1C,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,IAAA,6IAAY,EAAC;IACxC,IAAI,CAAC,QAAQ,UAAU,OAAO;IAE9B,MAAM,WAAW,IAAI,IAAI,IAAI,GAAG,EAAE,YAAY,CAAC,GAAG,CAAC;IACnD,IAAI,CAAC,UAAU;QACb,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;IAEA,MAAM,OAAQ,MAAM,IAAI,IAAI;IAC5B,IAAI,CAAC,KAAK,MAAM,EAAE;QAChB,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAiB,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,SAAS,+IAAc,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IACnD,IAAI,CAAC,QAAQ;QACX,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;IAEA,MAAM,QAAQ,0IAAS,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,OAAO,OAAO;IAC3D,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,KAAK,MAAM,EAAE;QAC1C,OAAO,wJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgD,GAAG;YAAE,QAAQ;QAAI;IACrG;IAEA,MAAM,MAAM,IAAI,OAAO,WAAW;IAElC,IAAI,KAAK,MAAM,KAAK,WAAW;QAC7B,OAAO,MAAM,GAAG;QAChB,iDAAiD;QACjD,6IAAY,CAAC,IAAI,CAAC;YAChB,IAAI,CAAC,EAAE,EAAE,KAAK,GAAG,IAAI;YACrB,QAAQ,KAAK,EAAE;YACf,YAAY;YACZ,UAAU,MAAM,QAAQ;YACxB,WAAW;QACb;IACF,OAAO,IAAI,KAAK,MAAM,KAAK,UAAU;QACnC,OAAO,MAAM,GAAG;QAChB,6IAAY,CAAC,IAAI,CAAC;YAChB,IAAI,CAAC,EAAE,EAAE,KAAK,GAAG,IAAI;YACrB,QAAQ,KAAK,EAAE;YACf,YAAY;YACZ,UAAU,MAAM,QAAQ;YACxB,WAAW;QACb;IACF,OAAO,IAAI,KAAK,MAAM,KAAK,WAAW;QACpC,OAAO,MAAM,GAAG;QAChB,MAAM,MAAM,GAAG;QACf,MAAM,SAAS,GAAG;QAClB,6IAAY,CAAC,IAAI,CAAC;YAChB,IAAI,CAAC,EAAE,EAAE,KAAK,GAAG,IAAI;YACrB,QAAQ,KAAK,EAAE;YACf,YAAY;YACZ,UAAU,MAAM,QAAQ;YACxB,WAAW;QACb;IACF;IAEA,OAAO,wJAAY,CAAC,IAAI,CAAC;QAAE;QAAQ;IAAM;AAC3C","debugId":null}}]
}