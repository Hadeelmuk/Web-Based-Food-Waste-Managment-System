module.exports=[28787,a=>{"use strict";var b=a.i(76681),c=a.i(26711),d=a.i(2471),e=a.i(71594),f=a.i(47462),g=a.i(52336),h=a.i(98110),i=a.i(14836);let j=(0,a.i(32269).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var k=a.i(46294),l=a.i(71709),m=a.i(58273),n=a.i(23474),o=a.i(25327);let p=(0,n.withAuth)(function({user:a}){let[n,p]=(0,m.useState)(""),[q,r]=(0,m.useState)(""),[s,t]=(0,m.useState)(""),[u,v]=(0,m.useState)(""),[w,x]=(0,m.useState)(""),[y,z]=(0,m.useState)(!1),[A,B]=(0,m.useState)([]),[C,D]=(0,m.useState)(!1),[E,F]=(0,m.useState)(""),[G,H]=(0,m.useState)(0),I=async()=>{D(!0);try{let a,b=JSON.parse(localStorage.getItem("user")||"{}");if(!b.userId){console.warn("[Frontend] No userId in localStorage:",b),D(!1);return}console.log("[Frontend] Fetching entries for user:",b.userId);let c=await fetch("/api/waste?recent=true",{method:"GET",headers:{"Content-Type":"application/json","x-user-id":b.userId}});console.log("[Frontend] Response status:",c.status,c.statusText);let d=c.headers.get("content-type");if(!d||!d.includes("application/json")){let a=await c.text();console.error("Response is not JSON:",d,a.substring(0,200)),F(`Error: Server returned ${d} instead of JSON`),D(!1);return}if(!c.ok){let a=null,b="";try{if(b=await c.text())if(console.log("[Frontend] Error response text:",b.substring(0,200)),b.trim().startsWith("{"))try{a=JSON.parse(b)}catch(c){console.error("[Frontend] Failed to parse error JSON:",c),a={message:b}}else a={message:b}}catch(c){console.error("[Frontend] Failed to read error response:",c),a={message:b=`Failed to read response: ${c instanceof Error?c.message:String(c)}`}}a&&Object.keys(a).length>0?console.error("[Frontend] API Error Response:",{status:c.status,statusText:c.statusText,error:a.error||a.message,message:a.message}):console.error("[Frontend] API Error Response:",{status:c.status,statusText:c.statusText,message:"No error details available"});let d=a?.error||a?.message||b||c.statusText||`Server error (${c.status})`;F(`Error: ${d} (Status: ${c.status})`),D(!1);return}try{a=await c.json(),console.log("[Frontend] API Response data:",JSON.stringify(a,null,2))}catch(a){console.error("[Frontend] Failed to parse JSON:",a),F("Error: Failed to parse JSON response"),D(!1);return}if(!a.entries){console.warn("[Frontend] No entries array in response. Response:",JSON.stringify(a)),F(`No entries array in response. Response: ${JSON.stringify(a)}`),B([]),D(!1);return}if(0===a.entries.length){console.log("[Frontend] Empty entries array - this is OK if no entries exist yet"),F("No entries found yet. Start logging waste above!"),B([]),D(!1);return}console.log(`[Frontend] Found ${a.entries.length} entries from API`),F(`Found ${a.entries.length} entries`);let e=a.entries.map(a=>{if(!a.id||!a.itemName)return console.warn("[Frontend] Invalid entry:",a),null;let b=a.itemName&&a.type?`${a.itemName} (${a.type})`:a.itemName||a.type||"Unknown";return{id:a.id,date:new Date(a.createdAt).toLocaleDateString(),type:b,quantity:`${a.quantity} kg`,assignedTo:a.assignedTo||"N/A",status:a.status?.toLowerCase()||"pending",createdAt:a.createdAt}}).filter(a=>null!==a);console.log(`[Frontend] Displaying ${e.length} transformed entries`),F(`Displaying ${e.length} entries`),B([...e]),H(a=>a+1)}catch(a){console.error("[Frontend] Error fetching recent entries:",a),console.error("[Frontend] Error details:",{message:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0}),F(`Error: ${a instanceof Error?a.message:String(a)}`)}finally{D(!1)}};(0,m.useEffect)(()=>{I();let a=setInterval(()=>{console.log("Auto-refreshing entries..."),I()},5e3);return()=>clearInterval(a)},[]);let J=async a=>{if(a.preventDefault(),!n||!q||!s||!u)return void o.toast.error("Please fill in all required fields");let b="edible"===n?"charity":"coffee"===n||"organic"===n||"expired"===n||"recyclable"===n?"farmer":null;if(!b)return void o.toast.error("Please select a valid waste type");z(!0);try{let a,c=JSON.parse(localStorage.getItem("user")||"{}");if(!c.userId){o.toast.error("Please log in again"),z(!1);return}let d={wasteType:{edible:"EDIBLE",coffee:"COFFEE_GROUNDS",organic:"ORGANIC",expired:"EXPIRED",recyclable:"RECYCLABLE"}[n]||"ORGANIC",subType:q,quantity:parseFloat(s),actionType:{charity:"DONATE",farmer:"coffee"===n?"COMPOST":"FARM"}[b]||"FARM",expiryDate:u,notes:w||void 0};console.log("[Frontend] POST /api/waste - Request body:",d);let e=await fetch("/api/waste",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":c.userId},body:JSON.stringify(d)});if(!e.ok){let a;try{a=await e.json()}catch(a){o.toast.error(`Server error: ${e.status} ${e.statusText}`),z(!1);return}let b=a?.error||a?.message||`Failed to add waste log (${e.status})`;o.toast.error(b),z(!1);return}try{a=await e.json()}catch(b){console.warn("Response OK but JSON parsing failed:",b),a=null}o.toast.success("Waste Log Added",{description:a?.message||"Your food waste entry has been successfully recorded.",duration:5e3}),p(""),r(""),t(""),v(""),x(""),console.log("[Frontend] POST success, fetching latest entries...");try{await I(),console.log("[Frontend] Entries refreshed successfully")}catch(a){console.error("[Frontend] Error refreshing entries after POST:",a)}}catch(a){console.error("[Frontend] Error submitting waste log:",a),console.error("[Frontend] Error details:",{message:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0}),o.toast.error(`An error occurred: ${a instanceof Error?a.message:"Please try again."}`)}finally{z(!1)}};return(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(c.DashboardNav,{}),(0,b.jsx)("main",{className:"pt-20 px-4 pb-8",children:(0,b.jsxs)("div",{className:"container mx-auto max-w-4xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"font-display font-bold text-3xl text-foreground mb-2",children:"Log New Waste"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Track your daily food waste - system will automatically classify for donation, composting, or drop"})]}),(0,b.jsx)(d.Card,{className:"p-4 mb-6 bg-blue-50 border-blue-200",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(j,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Waste Classification Guide:"}),(0,b.jsxs)("ul",{className:"space-y-1 text-blue-800",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Edible Food:"})," Goes to ",(0,b.jsx)("span",{className:"text-red-600 font-semibold",children:"Charity ONLY"})," (pastries, bread, etc.)"]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"All Other Types:"})," Go to ",(0,b.jsx)("span",{className:"text-green-600 font-semibold",children:"Farm ONLY"})," (coffee grounds, organic waste, expired, recyclable)"]})]})]})]})}),(0,b.jsx)(d.Card,{className:"p-8 mb-8",children:(0,b.jsxs)("form",{onSubmit:J,className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"itemName",children:"Item Name *"}),(0,b.jsx)(f.Input,{id:"itemName",type:"text",placeholder:"e.g., Pastries, Coffee Grounds",className:"h-12",value:q,onChange:a=>r(a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"wasteType",children:"Waste Type *"}),(0,b.jsxs)(h.Select,{value:n,onValueChange:p,required:!0,children:[(0,b.jsx)(h.SelectTrigger,{className:"h-12",children:(0,b.jsx)(h.SelectValue,{placeholder:"Select waste type"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"edible",children:"Edible Food (Pastries, Bread, etc.)"}),(0,b.jsx)(h.SelectItem,{value:"coffee",children:"Coffee Grounds"}),(0,b.jsx)(h.SelectItem,{value:"organic",children:"Organic Waste (Vegetables, Fruits)"}),(0,b.jsx)(h.SelectItem,{value:"expired",children:"Expired / Not Edible"}),(0,b.jsx)(h.SelectItem,{value:"recyclable",children:"Recyclable (Packaged Snacks)"})]})]})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"quantity",children:"Quantity (kg) *"}),(0,b.jsx)(f.Input,{id:"quantity",type:"number",step:"0.1",placeholder:"5.2",className:"h-12",value:s,onChange:a=>t(a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"expiry",children:"Expiry Date *"}),(0,b.jsx)(f.Input,{id:"expiry",type:"date",className:"h-12",value:u,onChange:a=>v(a.target.value),required:!0})]})]}),n&&(0,b.jsx)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-800",children:[(0,b.jsx)(k.CheckCircle,{className:"w-5 h-5"}),(0,b.jsxs)("p",{className:"text-sm font-medium",children:["edible"===n&&"✓ Edible Food → Will be assigned to CHARITY and appear in their marketplace",("organic"===n||"coffee"===n||"expired"===n||"recyclable"===n)&&"✓ This waste type → Will be assigned to FARM and appear in their marketplace"]})]})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"notes",children:"Notes (optional)"}),(0,b.jsx)(l.Textarea,{id:"notes",placeholder:"Add any additional notes...",className:"min-h-24",value:w,onChange:a=>x(a.target.value)})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsxs)(e.Button,{type:"submit",className:"flex-1 h-12 bg-primary hover:bg-primary/90 text-lg",disabled:y,children:[(0,b.jsx)(i.Trash2,{className:"w-5 h-5 mr-2"}),y?"Saving...":"Save Waste Log"]}),(0,b.jsx)(e.Button,{type:"button",variant:"outline",className:"h-12 px-8 bg-transparent",onClick:()=>{p(""),r(""),t(""),v(""),x("")},children:"Cancel"})]})]})}),(0,b.jsxs)(d.Card,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("h3",{className:"font-display font-bold text-xl text-foreground",children:["Recent Entries ",A.length>0&&`(${A.length})`]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[C&&(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Refreshing..."}),(0,b.jsx)(e.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{console.log("Manual refresh clicked"),I()},disabled:C,children:"Refresh"})]})]}),C&&0===A.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"Loading entries..."}):0===A.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-2",children:"No entries yet. Start logging waste above!"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Debug: Check browser console (F12) for API response"})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 font-display font-semibold text-sm text-muted-foreground",children:"Date"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-display font-semibold text-sm text-muted-foreground",children:"Type"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-display font-semibold text-sm text-muted-foreground",children:"Quantity"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-display font-semibold text-sm text-muted-foreground",children:"Assigned To"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 font-display font-semibold text-sm text-muted-foreground",children:"Status"})]})}),(0,b.jsx)("tbody",{children:A.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b border-border hover:bg-muted/50 transition-colors",children:[(0,b.jsx)("td",{className:"py-4 px-4 text-foreground",children:a.date}),(0,b.jsx)("td",{className:"py-4 px-4 text-foreground",children:a.type}),(0,b.jsx)("td",{className:"py-4 px-4 text-foreground",children:a.quantity}),(0,b.jsx)("td",{className:"py-4 px-4",children:(0,b.jsx)("span",{className:`inline-flex px-3 py-1 rounded-full text-xs font-medium ${"charity"===a.assignedTo?"bg-red-500/10 text-red-600":"farmer"===a.assignedTo?"bg-green-500/10 text-green-600":"bg-gray-500/10 text-gray-600"}`,children:"charity"===a.assignedTo?"Charity":"farmer"===a.assignedTo?"Farmer":"N/A"})}),(0,b.jsx)("td",{className:"py-4 px-4",children:(0,b.jsx)("span",{className:`inline-flex px-3 py-1 rounded-full text-xs font-medium ${"completed"===a.status||"collected"===a.status?"bg-primary/10 text-primary":"dropped"===a.status?"bg-gray-500/10 text-gray-600":"bg-amber-500/10 text-amber-600"}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})})]},`${a.id}-${G}`))},G)]})})]})]})})]})},["staff"]);a.s(["default",0,p],28787)}];

//# sourceMappingURL=FWMS_app_dashboard_log-waste_page_tsx_51171e90._.js.map